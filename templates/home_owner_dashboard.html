<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Homeowner Portal</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: Arial; display:flex; background:#f4f6f9; min-height:100vh; }

/* Sidebar */
.sidebar { width:240px; background:#2c3e50; color:#fff; display:flex; flex-direction:column; justify-content:space-between; padding:20px; position:fixed; height:100%; }
.sidebar h2 { text-align:center; margin-bottom:30px; }
.sidebar a { color:#ecf0f1; text-decoration:none; padding:12px; border-radius:8px; display:block; margin:8px 0; background:transparent; transition:0.3s; }
.sidebar a:hover, .active-tab { background:#34495e; }

/* Main */
.main { margin-left:260px; padding:20px; width:calc(100% - 260px); display:flex; flex-direction:column; }
.top-bar { display:flex; justify-content:space-between; align-items:center; background:#fff; padding:12px 20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
.logout-btn { padding:8px 16px; background:#e74c3c; color:white; border:none; border-radius:5px; cursor:pointer; }

/* Cards */
.cards { display:flex; gap:20px; margin-bottom:20px; }
.card { background:#fff; flex:1; padding:20px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; }
.card h3 { margin-bottom:8px; }
.number { font-size:32px; font-weight:bold; color:#2c3e50; }

/* Tables */
table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
th, td { padding:12px; border-bottom:1px solid #eee; text-align:left; }
tr:hover { background:#f1f1f1; }

/* Forms */
.form-container { background:#fff; padding:25px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); max-width:600px; margin:auto; }
.form-group { margin-bottom:20px; }
label { display:block; margin-bottom:8px; font-weight:bold; }
input, textarea, select { width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; }
.submit-btn { width:100%; padding:12px; background:#2c3e50; color:white; border:none; border-radius:6px; cursor:pointer; }
</style>
<script>
// Handle section navigation
function showSection(section) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById(section).style.display='block';
    document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active-tab'));
    document.getElementById('tab-'+section).classList.add('active-tab');
}

// Calculate total maintenance cost dynamically
function calculateTotalCost() {
    let total = 0;
    document.querySelectorAll('.request-cost').forEach(td => {
        let val = parseFloat(td.innerText) || 0;
        total += val;
    });
    document.getElementById('total-cost').innerText = total.toFixed(2);
}

window.onload = function() {
    // Show default section
    showSection('{{ section or "dashboard" }}');
    // Calculate total maintenance cost
    calculateTotalCost();
};
</script>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <div>
        <h2>Homeowner</h2>
        <a id="tab-dashboard" href="javascript:void(0)" onclick="showSection('dashboard')">Dashboard</a>
        <a id="tab-homes" href="javascript:void(0)" onclick="showSection('homes')">Homes</a>
        <a id="tab-tenants" href="javascript:void(0)" onclick="showSection('tenants')">Tenants</a>
        <a id="tab-requests" href="javascript:void(0)" onclick="showSection('requests')">Requests</a>
        <a id="tab-add" href="javascript:void(0)" onclick="showSection('add')">Add Request</a>
    </div>
    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
</div>

<!-- Main -->
<div class="main">
    <div class="top-bar">
        <h2>Welcome, {{ session['name'] }}</h2>
        <a class="logout-btn" href="{{ url_for('logout') }}">Logout</a>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="section">
        <div class="cards">
            <div class="card"><h3>Total Homes</h3><div class="number">{{ total_homes }}</div></div>
            <div class="card"><h3>Total Tenants</h3><div class="number">{{ total_tenants }}</div></div>
            <div class="card"><h3>Total Requests</h3><div class="number">{{ total_requests }}</div></div>
            <div class="card"><h3>Total Maintenance Cost</h3><div class="number" id="total-cost">0.00</div></div>
        </div>
    </div>

    <!-- Homes -->
    <div id="homes" class="section">
        <h2>My Homes</h2>
        <table>
            <tr><th>Home Name</th><th>Tenant</th><th>Rent</th></tr>
            {% for home in homes %}
            <tr>
                <td>{{ home.name }}</td>
                <td>{{ home.tenant_name }}</td>
                <td>{{ home.rent }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Tenants -->
    <div id="tenants" class="section">
        <h2>My Tenants</h2>
        <table>
            <tr><th>Tenant</th><th>Home</th><th>Rent</th><th>Open Requests</th></tr>
            {% for t in tenants %}
            <tr>
                <td>{{ t.name }}</td>
                <td>{{ t.home }}</td>
                <td>{{ t.rent }}</td>
                <td>{{ t.open_requests }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Requests -->
    <div id="requests" class="section">
        <h2>Maintenance Requests</h2>
        <table>
            <tr><th>Title</th><th>Home</th><th>Tenant</th><th>Status</th><th>Cost</th></tr>
            {% for r in requests %}
            <tr>
                <td>{{ r.title }}</td>
                <td>{{ r.home }}</td>
                <td>{{ r.tenant }}</td>
                <td>{{ r.status }}</td>
                <td class="request-cost">{{ r.cost or 0 }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Add Request -->
    <div id="add" class="section">
        <h2>Add New Request</h2>
        <div class="form-container">
            <form method="POST" action="{{ url_for('add_request') }}">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label>Home</label>
                    <select name="home_id">
                        {% for home in homes %}
                        <option value="{{ home.id }}">{{ home.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Tenant</label>
                    <select name="tenant_id">
                        {% for tenant in tenants %}
                        <option value="{{ tenant.id }}">{{ tenant.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Cost (Optional)</label>
                    <input type="number" name="cost">
                </div>
                <button class="submit-btn" type="submit">Submit</button>
            </form>
        </div>
    </div>
</div>

</body>
</html>
