<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
    <title>Manage Request #{{ request_data.id }}</title>
    <style>
        /* CSS from your original request, optimized for this detail view */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; display: flex; background: #f4f6f9; min-height: 100vh; color: #333; }
        .sidebar { width: 240px; background: #2c3e50; color: #fff; display: flex; flex-direction: column; justify-content: space-between; padding: 20px; }
        .sidebar h2 { text-align: center; margin-bottom: 30px; color: #ecf0f1; }
        .sidebar a { color: #ecf0f1; text-decoration: none; padding: 12px; border-radius: 8px; display: block; margin: 8px 0; transition: 0.3s; cursor: pointer; }
        .sidebar a:hover { background: #34495e; }
        .sidebar a.active { background: #34495e; }
        .main { flex: 1; display: flex; flex-direction: column; padding: 20px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 10px 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .user-actions { display: flex; align-items: center; gap: 15px; }
        .logout-btn { padding: 8px 16px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .logout-btn:hover { background: #c0392b; }
        .content-section { background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .content-section h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 20px; }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .detail-item { padding: 10px; border-left: 3px solid #3498db; background: #f9f9f9; }
        .detail-item strong { display: block; color: #555; font-size: 14px; }
        .detail-item p { margin: 0; font-size: 16px; font-weight: 500; }
        
        .management-actions { display: flex; gap: 30px; }
        .action-box { flex: 1; background: #ecf0f1; padding: 20px; border-radius: 8px; }
        .action-box h3 { color: #2c3e50; margin-bottom: 15px; border-bottom: 1px dashed #ccc; padding-bottom: 10px; }
        .action-box form { display: flex; flex-direction: column; gap: 10px; }
        .action-box select, .action-box button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
        .action-box button.update-btn { background: #2ecc71; color: white; border: none; cursor: pointer; transition: 0.3s; }
        .action-box button.update-btn:hover { background: #27ae60; }
        .delete-btn { background: #e74c3c; color: white; border: none; cursor: pointer; margin-top: 15px; }
        .delete-btn:hover { background: #c0392b; }
        
        .status-badge { padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: bold; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-in-progress { background: #cfe2ff; color: #084298; }
        .flash-message { padding: 15px; margin-bottom: 20px; border-radius: 5px; font-weight: bold; }
        .flash-message.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flash-message.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>

<body>

    <div class="sidebar">
        <div>
            <h2>Home Maintenance</h2>
            <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
            <a href="{{ url_for('admin_users') }}">Manage Users</a>
            <a href="{{ url_for('admin_all_requests') }}" class="active">All Requests</a>
        </div>
        <div>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>

    <div class="main">
        <div class="top-bar">
            <h3>Managing Request #{{ request_data.id }}</h3>
            <a href="{{ url_for('admin_all_requests') }}" class="logout-btn" style="background: #3498db;">‚Üê Back to Requests</a>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category if category != 'message' else 'success' }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="content-section">
            <h2>{{ request_data.title }}</h2>
            
            <div class="detail-grid">
                <div class="detail-item">
                    <strong>Tenant</strong>
                    <p>
                        <a href="{{ url_for('admin_view_tenant_requests', tenant_id=request_data.user_id) }}" class="action-link">
                            {{ request_data.tenant_fname }} {{ request_data.tenant_lname }} ({{ request_data.tenant_email }})
                        </a>
                    </p>
                </div>
                <div class="detail-item">
                    <strong>Current Status</strong>
                    <p>
                        {% if request_data.status == 'Pending' %}
                            <span class="status-badge status-pending">Pending</span>
                        {% elif request_data.status == 'Completed' %}
                            <span class="status-badge status-completed">Completed</span>
                        {% else %}
                            <span class="status-badge status-in-progress">In Progress</span>
                        {% endif %}
                    </p>
                </div>
                <div class="detail-item">
                    <strong>Date Submitted</strong>
                    <p>{{ request_data.date }}</p>
                </div>
                <div class="detail-item">
                    <strong>Assigned Technician</strong>
                    <p>{{ assigned_name }}</p>
                </div>
            </div>

            <h3>Description</h3>
            <p style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; white-space: pre-wrap;">{{ request_data.description }}</p>
        </div>

        <div class="management-actions">
            
            <div class="action-box">
                <h3>Update Status</h3>
                <form method="POST" action="{{ url_for('admin_manage_request', request_id=request_data.id) }}">
                    <input type="hidden" name="action" value="update_status">
                    <select name="status" required>
                        <option value="Pending" {% if request_data.status == 'Pending' %}selected{% endif %}>Pending</option>
                        <option value="In Progress" {% if request_data.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                        <option value="Completed" {% if request_data.status == 'Completed' %}selected{% endif %}>Completed</option>
                    </select>
                    <button type="submit" class="update-btn">Update Status</button>
                </form>
            </div>
            
            <div class="action-box">
                <h3>Assign Technician</h3>
                <form method="POST" action="{{ url_for('admin_manage_request', request_id=request_data.id) }}">
                    <input type="hidden" name="action" value="assign_technician">
                    <select name="assigned_to" required>
                        <option value="none" {% if request_data.assigned_to is none %}selected{% endif %}>-- Unassign --</option>
                        {% for tech in technicians %}
                            <option value="{{ tech.id }}" {% if request_data.assigned_to == tech.id %}selected{% endif %}>
                                {{ tech.fname }} {{ tech.lname }}
                            </option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="update-btn">Assign</button>
                </form>
            </div>
            
            <div class="action-box" style="flex-basis: 150px;">
                <h3>Delete Request</h3>
                <form method="POST" action="{{ url_for('admin_manage_request', request_id=request_data.id) }}" onsubmit="return confirm('Are you sure you want to permanently delete this request? This action cannot be undone.');">
                    <input type="hidden" name="action" value="delete">
                    <button type="submit" class="delete-btn">Delete</button>
                </form>
            </div>
            
        </div>

        <footer>
            <p>&copy; 2025 Home Maintenance System. Admin Management.</p>
        </footer>
    </div>

</body>
</html>